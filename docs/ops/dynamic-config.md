---
layout: default
title: Trace and dynamic configuration
---
Some components can be configured dynamically, for example to turn on detailed trace logs.

Note that due to the large amounts of information generated, trace is not sent to the centralized logging system.

## MessageSight

There are two ways to gather MessageSight trace. 

The slow, tedious way is to use the `platform must-gather` command on the MessageSight command line to collect the must-gather diagnostic data.
Then use the `file put` command to transfer the resulting unwieldy file to another system. Instructions for this are in the IBM Knowledge Centre 
for MessageSight - Google for it.
This method is slow because the file generated by the `platform must-gather` command is clogged with every possible log and trace file that might ever be 
required by service. And it's tedious because the `file put` command needs details of a site that can accept ftp, http or scp connections.

The much faster way is to use a service facility that allows you to open a secure shell on the MessageSight machine. Once on,
you can go straight to the information you want. The procedure is documented in the internal IBM MessageSight V1 wiki at
[Using a secure shell on a production machine] [1].
There you will also find a handy [list of files useful for debug] [2].

[1]: https://w3-connections.ibm.com/wikis/home?lang=en-us#!/wiki/W11ac9778a1d4_4f61_913c_a76a78c7bff7/page/Using%20a%20secure%20shell%20on%20a%20production%20machine
[2]: https://w3-connections.ibm.com/wikis/home?lang=en-us#!/wiki/W11ac9778a1d4_4f61_913c_a76a78c7bff7/page/Description%20of%20must-gather%20files%20added%20for%20IMA

## MessageSight Proxy

Some proxy configuration properties may be updated dynamically while a proxy is running. Examples are `TraceLevel` and `MeteringInterval`.

The mechanism for updating proxy configuration properties is the Consul key/value store. This is a simple database that is maintained across all systems by the Consul server. The proxy connector listens for changes in the key/value store and updates the proxy configuration whenever a value is added or changed.

Proxy configuration properties are stored in Consol under the folder `instanceID_proxyname/` where `instanceID` is the name of the instance in SoftLayer, for example `msproxy-0` or `msproxy-quickstart-0`, and `proxyname` is either `regproxy` or `qsproxy`. The key of the property is its name in the proxy configuration, for example `MeteringInterval`.

To update a property, use the Consul UI or REST API.

### Using the UI

1. Click on the KEY/VALUE button, then click on the appropriate folder such as msproxy-0_regproxy. Any properties previously updated via this mechanism will be listed - the list will likely be empty on a new system.
2. To update a property for the first time, enter its name in the Create Key field next to the folder name, enter a value in the box and click CREATE. Or click on an existing property, enter a value in the box and click UPDATE.

### Using the REST API
The Consul REST API is found at `http://hostname:8500/v1/kv` where `hostname` is any server running Consul. To update a property, issue a PUT with the folder and property name in the URL and the desired value in the body of the request. For example:

~~~ http
PUT http://hostname:8500/v1/kv/msproxy-0_regproxy/TraceLevel
5,tcp=7

PUT http://hostname:8500/v1/kv/msproxy-quickstart-0_qsproxy/MeteringInterval
60
~~~

Updates made via the UI or REST API are reflected immediately in the proxy configuration. If you are monitoring the proxy logs you will see an entry like this:

~~~
ConfigHandler ConsulListener N: "run" "INFO" "Configuration property TraceLevel is changed from 5,tcp=6 to 9"
~~~

Deleting a property from Consul does not affect the value of the property in the proxy configuration. To reset a property to its original value, find the original value in the proxy's configuration file and issue another update with this value.

Dynamic proxy configuration is appropriate only for changes that are intended to be temporary or shortlived. Changes meant to be permanent should be made in the proxy's configuration file. To this end, all properties in Consul are cleared at proxy startup.